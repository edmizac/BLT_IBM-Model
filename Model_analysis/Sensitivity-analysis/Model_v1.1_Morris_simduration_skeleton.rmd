---
title: "Model v1.1 Sensitivity analysis - Morris screening"
author: "Eduardo Zanette"
date: "21/07/2022"
navlink: "[NAVTITLE](http://NAVLINK/)"
og:
  type: "article"
  title: "opengraph title"
  url: "optional opengraph url"
  image: "optional opengraph image link"
footer:
  - content: '[link1](http://example.com/) • [link2](http://example.com/)<br/>'
  - content: 'Copyright blah blah'
output: markdowntemplates::skeleton
abstract: |

  This document was produced for reporting the first well succeeded sensitivity analysis of the BLT Model with the nlrx package. The main aim was to see the general effect of each of the five parameters below and check if we could drop an implementation (which we call 'phenology'). For this, we ran the model with the same parameters with phenology "on" and "off".
  
  We used the Guareí environment with resources from July). The parameters varied were (and can be checked on the "Model_v1.1_2022-07-14d.R" file in Sensitivity-Analysis folder):
    
  * Parameters related to memory:
  1. "step_forget" = list(min=1, max = 100, step = 10, qfun="qunif")
  2. "visual" = list(min=1, max = 3, step = 1, qfun="qunif")
  3. "prop_trees_to_reset_memory" = list(min = 1, max = 8, step = 1, qfun="qunif")
                              
  * Parameters related to movement:
  4. "p-foraging-while-traveling" = list(min = 0.1, max = 0.6, step = 0.1, qfun="qunif")
  5. "duration" = list(min=1, max = 6, step = 2, qfun="qunif")
   
   
# fontsize: 12pt
# spacing: double
toc: yes
toc_depth: 3
number_sections: yes

---


```{r setup, include=FALSE}
# Knitr
knitr::opts_chunk$set(echo = TRUE,
                      fig.align='center')

# Packages
library("knitr")
library("rmarkdown")
library("flextable") ## having nice tables working also in LibreOffice
library("officer")
library("here")
library("tidyverse")
library("ggplot2")
library("nlrx")

# Plots
theme_set(theme_bw(base_size = 10))

```

# Morris sensitivity

### Code
```{r, warning=FALSE, message=FALSE}
nl_off <- readRDS("morris_2022-07-20_phenology-off.RDS")
morris_off <- analyze_nl(nl_off)
morris_off$phenology <- "phenology off"
rm(nl_off)  

nl_on <- readRDS("morris_2022-07-20_phenology-on.RDS")
morris_on <- analyze_nl(nl_on)
morris_on$phenology <- "phenology on"
rm(nl_on)  

morris <- dplyr::bind_rows(morris_on, morris_off)
rm(morris_on); rm(morris_off)
```

\newpage

### Plot
```{r}
morris %>% 
  ggplot(aes(x=value, y=parameter, fill = index)) +
  geom_boxplot(lwd= 0.1) +
  geom_vline(xintercept = 0) +
  facet_wrap(~phenology) +
  ggtitle("Morris effects (all metrics)")
```

\newpage

```{r}
morris %>% 
  ggplot(aes(x=value, y=parameter, fill = index)) +
  geom_boxplot(lwd= 0.1) +
  geom_vline(xintercept = 0) +
  facet_grid(metric ~ phenology) +
  ggtitle("Morris effects (by metrics)")
```


### Interpretation ([Thiele et al 2014](https://www.jasss.org/17/3/11.html))

According to Thiele et al.:\
```
"Based on individually randomised one-factor-at-a-time designs, it estimates the effects of changes in the input factor levels, i.e., the parameter values, which are called elementary effects (EEs). The EEs >are statistically analysed to measure their relative importance. The results of the Morris method are two measures for every investigated input factor: μ, the mean of the elementary effects, as an estimate of the overall influence of an input factor/parameter, and σ, the standard deviation of the elementary effects, as an estimate of higher order effects, i.e., non-linear and/or interaction effects (Campolongo et al. 2007). Still, this method does not identify interactions between specific input factors but instead delivers only lumped information about the interaction effect of one factor with the rest of the model (Campolongo, Kleijnen et al. 2000)."
```

So it means that we are not estimating the effect of inputs (step_forget, visual, etc) on the outputs of our interest (Daily path length and Home range size, still not calculated), but the relative importance of the inputs with the rest of the model.

Thiele et al. continues:\
```
> "For the interpretation of the results, Saltelli et al. (2004) recommend comparing the values of σ and μ, or better μ*. High values of μ indicate that a factor has an important overall influence on the output and that this effect always has the same sign (Saltelli et al. 2004). In contrast, when there is a high value of μ* and a low value of μ, it indicates that there is a non-monotonic effect on the output. High values of σ indicate that the elementary effects strongly depend on the choice of the other input factors, whereas a high μ or μ* and a low σ indicate that the elementary effect is almost independent of the values of the other factors, which means that it is a first-order/main effect. In summary, the Morris screening method delivers measures of relative importance but cannot quantify the strength of the effects."
```
So now the method estimated the effect on the output? I'm not sure about this anymore.

Anyhow, it is clearly seen that mu values are consistently (for every model parameter) low, mustar is high (non-monotonic relation between input and ouput) and sigma is high (the model param depends on other input parameters). I interpret this as: **parameters in the model do not have a consistent effect (on the model, not on the ouputs, because the outputs have not been taken into consideration)**.


