---
title: "Model v1.1 Sensitivity analysis - Morris screening"
author: "Eduardo Zanette"
date: "21/07/2022"
output:
  html_document:
abstract: |

  This document was produced for reporting the first well succeeded sensitivity analysis of the BLT Model with the nlrx package. The main aim was to see the general effect of each of the five parameters below and check if we could drop an implementation (which we call 'phenology'). For this, we ran the model with the same parameters with phenology "on" and "off". However, we only used the mertrics "day" and "timestep" for the Morris sensitiviy. This will make one analysis possible though: which parameter of those 5 below resulted in more agent inviability, as shorter simulation runs represent the agents dying.
  
  We used the Guareí environment with resources from July). The parameters varied were (and can be checked on the "Model_v1.1_2022-07-14d.R" file in Sensitivity-Analysis folder):

  * Parameters related to memory:
  1. "step_forget" = list(min=1, max = 100, step = 10, qfun="qunif")
  2. "visual" = list(min=1, max = 3, step = 1, qfun="qunif")
  3. "prop_trees_to_reset_memory" = list(min = 1, max = 8, step = 1, qfun="qunif")
                              
  * Parameters related to movement:
  4. "p-foraging-while-traveling" = list(min = 0.1, max = 0.6, step = 0.1, qfun="qunif")
  5. "duration" = list(min=1, max = 6, step = 2, qfun="qunif")
   
   
fontsize: 12pt
spacing: double
toc: yes
toc_depth: 3
number_sections: yes

---


```{r setup, include=FALSE}
# Knitr
knitr::opts_chunk$set(echo = TRUE,
                      fig.align='center')

# Packages
library("knitr")
library("rmarkdown")
library("flextable") ## having nice tables working also in LibreOffice
library("officer")
library("here")
library("tidyverse")
library("ggplot2")
library("nlrx")

# Plots
theme_set(theme_bw(base_size = 10))

```

# Morris sensitivity

### Code
```{r, warning=FALSE, message=FALSE}
nl_off <- readRDS(here("Model_analysis", "Sensitivity-analysis", "temp",
                       "morris_2022-07-20_phenology-off.RDS"))
morris_off <- analyze_nl(nl_off)
morris_off$phenology <- "phenology off"
rm(nl_off)  

nl_on <- readRDS(here("Model_analysis", "Sensitivity-analysis",
                       "temp","morris_2022-07-20_phenology-on.RDS"))
morris_on <- analyze_nl(nl_on)
morris_on$phenology <- "phenology on"
rm(nl_on)  

morris <- dplyr::bind_rows(morris_on, morris_off)
rm(morris_on); rm(morris_off)
```

\newpage

### Plot

```{r}
p1 <- morris %>% 
  dplyr::filter(metric=="day_mean") %>% 
  ggplot(aes(x=value, y=parameter, fill = index)) +
  geom_boxplot(lwd= 0.1) +
  geom_vline(xintercept = 0) +
  facet_grid(~phenology) +
  ggtitle("Morris effects on number of simulation days")
  
p2 <- morris %>% 
  dplyr::filter(metric=="timestep_mean") %>% 
  ggplot(aes(x=value, y=parameter, fill = index)) +
  geom_boxplot(lwd= 0.1) +
  geom_vline(xintercept = 0) +
  facet_grid(~phenology) +
  ggtitle("Morris effects on number of simulation day length (timesteps)")

p1; p2

  
```


### Interpretation ([Thiele et al 2014](https://www.jasss.org/17/3/11.html))

About the Morris method, to Thiele et al. says\

> "Based on individually randomised one-factor-at-a-time designs, it estimates the effects of changes in the input factor levels, i.e., the parameter values, which are called elementary effects (EEs). The EEs are statistically analysed to measure their relative importance. The results of the Morris method are two measures for every investigated input factor: μ, the mean of the elementary effects, as an estimate of the overall influence of an input factor/parameter, and σ, the standard deviation of the elementary effects, as an estimate of higher order effects, i.e., non-linear and/or interaction effects (Campolongo et al. 2007). Still, this method does not identify interactions between specific input factors but instead delivers only lumped information about the interaction effect of one factor with the rest of the model (Campolongo, Kleijnen et al. 2000)."


Thiele et al. continues:\

> "For the interpretation of the results, Saltelli et al. (2004) recommend comparing the values of σ and μ, or better μ-star. *High values of μ indicate that a factor has an important overall influence on the output and that this effect always has the same sign (Saltelli et al. 2004). In contrast, when there is a high value of μ-star and a low value of μ, it indicates that there is a non-monotonic effect on the output. High values of σ indicate that the elementary effects strongly depend on the choice of the other input factors, whereas a high μ or μ-star and a low σ indicate that the elementary effect is almost independent of the values of the other factors, which means that it is a first-order/main effect*. In summary, the Morris screening method delivers measures of relative importance but cannot quantify the strength of the effects."


Anyhow, it is clearly seen that mu values are consistently (for every model parameter) low, mustar is high (non-monotonic relation between input and ouput) and sigma is high (the model param depends on other input parameters). I interpret this as: **parameters in the model do not have a consistent effect on the simulation time (and thus, agent survivability)**


