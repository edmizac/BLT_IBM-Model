---
title: "Model v1.1 Sensitivity analysis - Full Factorial"
author: "Eduardo Zanette"
date: "05/08/2022"
output:
  pdf_document:
    latex_engine: xelatex
abstract: |

  This document was produced for reporting the sensitivity analysis (Full factorial design) of the BLT Model with the nlrx package. The main aim was to see if we could drop an implementation (which we called 'phenology' so far, but it is now called 'feeding bout' for sake of clarity). We also aimed at testing the effect of each of the four parameters below. For this, we ran the model with the same parameters with phenology "on" and "off". We used the Guareí environment with resources from July.
    
  * Parameters related to memory:
  1. "step_revisit" = list(min=1, max = 100, step = 10, qfun="qunif")
  2. "visual" = list(min=1, max = 3, step = 1, qfun="qunif")
                              
  * Parameters related to movement:
  4. "p-foraging-while-traveling" = list(min = 0.1, max = 0.6, step = 0.1, qfun="qunif")
  5. "duration" = list(min=1, max = 6, step = 2, qfun="qunif")
   

fontsize: 12pt
spacing: double
toc: yes
toc_depth: 3
number_sections: yes
---

\pagenumbering{arabic}

nlrx script available in "Model_v1.1_FullFact_large.R" and "Model_v1.1_FullFact_small.R" in [this link](https://drive.google.com/drive/u/0/folders/1yZLGoHNYWlbxjewjAnXcV0E3WmCZn9vg)

#### The *five* conclusions are:

1. Feeding bout parameterization does not seem to be needed for Guareí.
2. Without the feeding bout parametrization, agents usually hit higher levels of energy. This might be the reason why DPL is lightly higher in these runs.
3. But runs with parameterized feeding bout ("on") varied more in output (home range and daily path length)
4. Parameters (inputs) that showed consistent trend on variables (outputs): 
  + step revisit on HR & DPL (direct but weak relationship)
  + p foraging on DPL (inverse strong relationship)
  + duration on DPL (inverse strong relationship)
5. Simulated home ranges have a mean of 20 hectares. I still haven't checked monthly empirical home range sizes of Guareí, but the size for all the fours months is ~50 ha.

\pagebreak

```{r setup, include=FALSE, warning=FALSE}
# Knitr
knitr::opts_chunk$set(echo = TRUE,
                      fig.align='center')

# Packages
library("knitr")
library("rmarkdown")
library("flextable") ## having nice tables working also in LibreOffice
library("officer")
library("here")
library("tidyverse")
library("ggplot2")
library("ggpubr")
library("gridExtra")
# library("ggspatial")
library("reshape2")
library("sp")
library("sf")
library("adehabitatHR")
library("circular")
library("nlrx")
library("amt", quietly = TRUE)

# GIS
our_crs <- "+proj=utm +zone=22 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
gua_xlim_all = c(780000, 782350)
gua_ylim_all = c(7407080, 7408250)
gua.x.min = 781587
gua.x.max = 782361.5
gua_xlim_set = c(781200, 782350)
gua_ylim_set = c(7407250, 7408250) 
sma_xlim_set = c(364400, 366000)
sma_ylim_set = c(7540500, 7541700)
taq_xlim_set = c(370500, 373200)
taq_ylim_set = c(7498750, 7500550)
suz_xlim_set = c(705300, 706200)
suz_ylim_set = c(7480800, 7481600) # 7480990,


# Plots
theme_set(theme_bw(base_size = 10))
```

# Data

### Read and clean
```{r Read data, warning=FALSE}
# Read data from experiments
nl_off_s <- readRDS(here("Model_analysis/Sensitivity-analysis/v1.1_August2022/temp/Model_v1.1_Sensitivity_FullFact_2022-08-04d/", "morris_2022-08-04_phenology-off_small.rds"))
data_off_s <- unnest_simoutput(nl_off_s) ; rm(nl_off_s)

data_off_s <- data_off_s %>% 
  mutate(feedingbout = "Feeding bout off")

nl_on_s <- readRDS(here("Model_analysis/Sensitivity-analysis/v1.1_August2022/temp/Model_v1.1_Sensitivity_FullFact_2022-08-04d/", "morris_2022-08-04_phenology-on_small.rds"))
data_on_s <- unnest_simoutput(nl_on_s) ; rm(nl_on_s)

data_on_s <- data_on_s %>% 
  dplyr::select(-`phenology-on?`) %>%
  mutate(feedingbout = "Feeding bout on")

# Bind all together
db <- bind_rows(data_on_s, data_off_s)
rm(data_on_s); rm(data_off_s)

# Last cleaning:
 # Remove - and space characters:
db <- db %>% dplyr::rename_all(~str_replace_all(., c("-" = "_", 
                                                     "\\." = "_",
                                                     " " = ""))) %>%
  rename("p_foraging" = "p_foraging_while_traveling",
         x = "x_UTM",
         y = "y_UTM") %>%
  dplyr::select(c(-agent, -breed))

# names(db)
unique(db$random_seed) # 10 seeds, 5 seeds for on and 5 seeds for off

# Group and define unique id
db <- db %>% group_by(random_seed, siminputrow, feedingbout,
                      step_forget, visual, p_foraging, 
                      duration, day) %>%
  mutate(id = paste0("GuaSim_", cur_group_id())) # This creates id groups = day for each combination of variables + run replicate. Now it is not needed to group every time and we can calculate variables by id (DPL, home range, etc)
```
```{r, echo=F, eval=FALSE}
gc()
```


### Check parameter variation (input)

```{r, echo=F}
# Don't know how to make with dplyr:
# db %>% 
#   dplyr::summarise_all(funs(n_distinct()))


# In base R (Ronald solution):
val_step_forget <- sort(unique(db$step_forget))
val_p_foraging  <- sort(unique(db$p_foraging))
val_duration    <- sort(unique(db$duration))
val_visual      <- sort(unique(db$visual))
val_random_seed <- sort(unique(db$random_seed))

ptable <- cbind("step_revisit", paste(sprintf("%4.2f", val_step_forget)
                               , collapse = ", "))
ptable <- rbind(ptable, cbind("p_foraging", paste(sprintf("%4.2f", val_p_foraging)
                                        , collapse = ", ")))
ptable <- rbind(ptable, cbind("duration",   paste(sprintf("%4.2f", val_duration)
                                        , collapse = ", ")))
ptable <- rbind(ptable, cbind("visual",     paste(sprintf("%4.2f", val_visual)
                                        , collapse = ", ")))

ptable <- as.data.frame(ptable)
names(ptable) <- c("Parameter", "Values")

  # print table
ptable %>% flextable() %>% autofit() %>% 
  set_caption("Input parameters for Full Factorial Sensitivity")
```


# Calculate DPL

```{r, eval=F}
# Transform dist_traveled from patch to meters (script Scale_Netlogo.R)
db <- db %>% 
  mutate(dist_traveled = case_when(dist_traveled == 1 ~ 28.28803,
                                   dist_traveled == 0.7 ~ 19.80162,
                                   dist_traveled == 0.0 ~ 0))
# Sum up DPL
db <- db %>%
  group_by(id) %>%
  mutate(DPL = sum(dist_traveled)) %>% 
  ungroup() %>% as_tibble() # the tbl has to be ungrouped for the amt pckage nest() function to work
```


# Calculate HR

```{r, eval=F, warning=FALSE}
# amt vignette: https://cran.r-project.org/web/packages/amt/vignettes/p1_getting_started.html


# For a specific group:
# a1 <- db %>% filter(id == "GuaSim_19") %>% # agente morreu na maioria das primeiras runs
a <- db %>% filter(id == "GuaSim_1150") 
a <- db %>% filter(id == "GuaSim_5513") 

# saveRDS(a, here("Model_analysis",  "Hr_NetLogo.rds"))

a1 <- a %>%
  make_track(.x=x, .y=y, id = id, crs = our_crs) %>% nest(data = -c(id))


kde1 <- a1 %>%
    hr_kde(.,levels = 0.5)

kde1 <- a1 %>%
    hr_kde(levels = 0.95)


kde1$h
kde1$estimator
kde1$ud
kde1$h

plot(kde1)
amt::hr_isopleths(kde1)


# Testing NetLogo code calc-homerange:
#KDE
db_nest <- a1 %>% 
  mutate( KDE95 = amt::map(data, ~ hr_kde(., level = 0.95)), 
          KDE50 = amt::map(data, ~ hr_kde(., level = 0.50)) 
          )

db_nest <- db_nest %>%  
  select(-data) %>% pivot_longer(KDE95:KDE50, names_to = 'KDE_value', values_to = 'hr')

db_nest <- db_nest %>% 
  mutate(hr_area = map(hr, hr_area)) %>%
  unnest(cols = hr_area)

db_nest <- db_nest %>% dplyr::select(-c('what', 'hr'))

db_nest <- db_nest %>% mutate(hr_area_ha = area / 10000)

KDE95 <- db_nest %>% 
  dplyr::filter(KDE_value == "KDE95") %>%  
  dplyr::select(hr_area_ha) %>% 
  unlist() %>% as.vector() %>% round(2)

KDE50 <- db_nest %>% 
  dplyr::filter(KDE_value == "KDE50") %>%  
  dplyr::select(hr_area_ha) %>% 
  unlist()  %>% as.vector() %>%  round(2)


db_nest[ 1 , ]



hr_area(kde1) %>% 
  mutate(area_ha = area / 10000)


#AKDE
a2 <- a %>%
  mutate(
    mins = timestep * 5,
    mins = as.period(mins, unit = "minutes"),
    mins = seconds_to_period(mins),
    mins = hms::hms(mins),
    datetime = paste(Sys.Date(), mins),
    datetime = ymd_hms(datetime, tz = "America/Sao_Paulo")
  )

a2 %>% str()
    

a2 <- a2 %>%
  make_track(.x=x, .y=y, .t = datetime, id = id, crs = our_crs) %>% nest(data = -c(id))

db_nest_a2 <- a2 %>% 
  mutate( 
    AKDE95 = amt::map(data, ~ hr_akde(., fit_ctmm(., "auto"))),
    KDE95 = amt::map(data, ~ hr_kde(., level = 0.95))
  )

# db_nest_a2$KDE95
# hr_area(db_nest_a2)

db_nest_a2 <- db_nest_a2 %>%  
  select(-data) %>% pivot_longer(AKDE95:KDE95, names_to = 'KDE_value', values_to = 'hr')

db_nest_a2 <- db_nest_a2 %>% 
  mutate(hr_area = map(hr, hr_area)) %>%
  unnest(cols = hr_area)

# db_nest_a2 <- db_nest_a2 %>% dplyr::select(-c('what', 'hr'))

db_nest_a2 <- db_nest_a2 %>% mutate(hr_area_ha = area / 10000)


# Other travel patterns

straight1 <- a1 %>%
  amt::straightness()

# a1 %>% steps_by_burst(.)

mov1 <- a1 %>%
  mutate(
    DPL = tot_dist(.),
    step_length = step_lengths(.),
    turn_ang = direction_rel(.),
    MSD = msd(.),
    straightness = straightness(.),
    sinuosity = sinuosity(.)
  )



# For all groups (require dplyr::nest())
db_nest <- db %>%
  dplyr::filter(between(siminputrow, 50, 51)) %>%  # in case you want to subset some data first
  make_track(.x=x, .y=y, id = id, crs = our_crs) %>% 
  nest(data = -c(id)) # group only by id or use: nest(data = c(x_, y_, t_, var1))

  # example run:  
db_nest$data[[1]]

  # calculate HR metrics for every list (=id = run) using map()
db_nest <- db_nest %>% 
  mutate(
    KDE95 = amt::map(data, ~ hr_kde(., level = 0.95)),
    KDE50 = amt::map(data, ~ hr_kde(., level = 0.50))
  )


```

```{r, eval=F, warning=FALSE}
db_nest2 <- db_nest %>% 
  select(-data) %>% # drop all track data, we don't need it anymore (it was used to calculate HR)
  pivot_longer(KDE95:KDE50, names_to = "KDE_value", values_to = "hr")

db_nest2 <- db_nest2 %>% 
  mutate(hr_area = map(hr, hr_area)) %>% 
  unnest(cols = hr_area)

# drop hr and level columns
db_nest2 <- db_nest2 %>%
  dplyr::select(-c("what","hr"))

# Merge HR to db and save
db <- left_join(db, db_nest2)
# db <- left_join(db_nest2, db)
db <- db %>% 
  mutate(hr_area_ha = area / 10000)

a <- db %>% 
  select(id, random_seed, KDE_value, hr_area_ha)

# # I only calculated KDE95, so I'll simplify the collums
# db <- db %>% 
#   select(-c(KDE_value, area)) %>% 
#   rename(KDE95 = hr_area_ha)

db <- db %>% 
  dplyr::select(-c("level", "area"))

# Save data imediatly because it is very memory consuming:
# db %>% write.csv(file=here("Model_analysis", "Sensitivity-analysis",
# "temp", "HR_values_FF_2022-08-06d.csv"))

```

As I didn't use href values in the function hd_kde(), the home range values might be smaller. I ran analysis with h=30 and h=60 before this script was lost with a crash on August 03rd 2022, but the results didn't change too much. So the reason why the home range is so small for runs (compare with runs with speed_val) might be because there's something wrong in the model or because in the speedval runs I was using the home range of all months for validation.


# Load data
The functions to estimate HR take to much time, so we will read the saved .csv (chunks above are with eval=F)
```{r}
db <- read_csv(here("Model_analysis", "Sensitivity-analysis",
                    "temp", "HR_values_FF_2022-08-06d.csv")) %>% 
  select(-1)

# Transform params into factors
  ### if you don't make it a factor, ggplot does not plot side by side
# params <- c("step_forget", "visual", "p_foraging", "duration")
db <- db %>% 
  mutate_if(is.character, as.factor) %>% 
  mutate(across(2:5, as.factor))
# str(db)
```


# Effect of feeding bout

Apparently smaller changes in DPL (\~60 m longer when feeding bout is off) and no changes in Home range

```{r effect of feeding}
# DPL
DPL_means_df <- db %>% 
  group_by(feedingbout) %>%
  summarise(meanDPL = mean(DPL))

db %>%
  ggplot(aes(x=DPL, fill = feedingbout)) +
  geom_density(alpha=0.4) +
  xlab("DPL (m)") +
  ggtitle("Effect of feeding bout on DPL") +
  geom_vline(data=DPL_means_df, aes(xintercept = meanDPL, 
                                   color = feedingbout))

# Home range
HR_means_df <- db %>% 
  group_by(feedingbout) %>% 
  summarise(meanHR = mean(KDE95))

db %>%
  ggplot(aes(x=KDE95, fill = feedingbout)) +
  geom_density(alpha=0.4) +
  xlab("Home range size (ha) - KDE 95%") +
  ggtitle("Effect of feeding bout on home range size") +
  geom_vline(data=HR_means_df, aes(xintercept = meanHR, 
                                   color = feedingbout))


```
```{r, include=FALSE}
# db %>%
#   ggplot(aes(x=KDE50, fill = feedingbout)) +
#   geom_density(alpha=0.4)

# db_temp <- db %>% 
#   pivot_longer(cols = c(KDE50, KDE95), 
#                names_to = "HR_ref", values_to = "HRvalues")
# 
# HR_means_df <- db_temp %>% 
#   group_by(phenology, HR_ref) %>%
#   summarise(meanHR = mean(HRvalues))
# 
# 
# db_temp %>% 
# db %>% 
#   ggplot() +
#   geom_density(aes(x=KDE95, fill = feedingbout), alpha=0.4) +
#   # facet_wrap(~HR_ref) +
#   geom_vline(data=HR_means_df, aes(xintercept = meanHR, 
#                                    color = feedingbout)) +
#   xlab("Home range size (ha)") #; rm(db_temp)
```


### Effect of step_revisit
```{r effect of step_revisit}
# db %>% 
#   group_by(feedingbout, step_forget, random_seed) %>% 
#   dplyr::summarise(nruns = n())

# db$siminputrow %>% summary() #number of runs


# DPL
p1 <- db %>% 
  ggplot(aes(x=step_forget, y=DPL, fill = feedingbout)) +
  ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  ggtitle("Effect of step_revisit on DPL") +
  xlab("step_revisit") +
  theme(legend.position = "bottom")
  # facet_wrap(~feedingbout)


# Home range
p2 <- db %>% 
  ggplot(aes(x=step_forget, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  ggtitle("Effect of step_revisit on\nhome range size (KDE 95%)") +
  theme(legend.position = "bottom")


gridExtra::grid.arrange(arrangeGrob(p1, p2,
                                    ncol = 2, nrow = 1))

```
\pagebreak

### Effect of visual
```{r effect of visual}
# DPL
p3 <- db %>% 
  ggplot(aes(x=visual, y=DPL, fill = feedingbout)) +
  ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  ggtitle("Effect of visual on DPL (m)\n") +
  theme(legend.position = "bottom")
  # theme(legend.position = "none")

  # facet_wrap(~feedingbout)


# Home range
p4 <- db %>% 
  ggplot(aes(x=visual, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  ggtitle("Effect of visual on\nhome range (KDE 95%)") +
  theme(legend.position = "bottom")

# p3; p4

gridExtra::grid.arrange(arrangeGrob(p3, p4,
                                    ncol = 2, nrow = 1))
```
\pagebreak

### Effect of p_foraging
```{r effect of p-foraging-while-traveling}
# DPL
p5 <- db %>% 
  ggplot(aes(x=p_foraging, y=DPL, fill = feedingbout)) +
  ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  ggtitle("Effect of p_foraging on DPL (m)\n") +
  theme(legend.position = "bottom")

  # facet_wrap(~feedingbout)


# Home range
p6 <- db %>% 
  ggplot(aes(x=p_foraging, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  ggtitle("Effect of p_foraging on\nhome range size (KDE 95%)") +
  theme(legend.position = "bottom")



gridExtra::grid.arrange(arrangeGrob(p5, p6,
                                    ncol = 2, nrow = 1))
```
\pagebreak

### Effect of duration
```{r effect of duration}
# DPL
p7 <- db %>% 
  ggplot(aes(x=duration, y=DPL, fill = feedingbout)) +
  geom_boxplot(width = 0.4) +
  ylab("DPL (m)") +
  ggtitle("Effect of duration on DPL (m)\n") +
  theme(legend.position = "bottom")

  # facet_wrap(~feedingbout)


# Home range
p8 <- db %>% 
  ggplot(aes(x=duration, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  ggtitle("Effect of duration on\nhome range (KDE 95%)") +
  theme(legend.position = "bottom")


gridExtra::grid.arrange(arrangeGrob(p7, p8,
                                    ncol = 2, nrow = 1))
```
\pagebreak

### Effect on survival
```{r}
# Some runs finished with low energy (probably the agents died)
db %>%
  ggplot(aes(x=energy, fill = feedingbout)) +
  geom_density(alpha=0.4)

set.seed(173)
db %>% #group_by(siminputrow) %>% 
  filter(energy < 5) %>%
  sample_n(10) %>% 
  flextable()

```
Most of the agents that died are within visual >= 2, but not necessarily. This means these values are too high If monkeys were restricted and without resources, they'd probably come back to the previous one up to total fruit depletion. This is process of prefering resources not recently visited does not include a mechanism of ignoring it in case the energy is low. I wonder if making agents dead really makes sense. Maybe restoring the seed_pot_list to its original state would be the most relistic way.

Another thing to notice: energy usually goes to 0 when the agents are in the same point (look to x and y). I'll still investigate this.
\pagebreak


# Further analysis (subset)

Up to now I have plotted all the simulations in relation to one unique variable. Now, we will plot runs while keeping the other variables constant

```{r Configure plots}
theme_set(theme_bw(base_size = 5))
```


### Step revisit with data subset
```{r step_forget}
# Subset
db_ss <- db %>%  
  filter(p_foraging == val_p_foraging[1] &
           # step_forget == val_step_forget[1] &
           duration == val_duration[1] &
           visual == val_visual[1])

p1 <- db_ss %>%
  ggplot(aes(x=step_forget, y=DPL, fill = feedingbout)) +
  # ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  xlab("step_revisit") +
  theme(legend.position = "none")

# Home range
p2 <- db_ss %>% 
  ggplot(aes(x=step_forget, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot()  +
  xlab("step_revisit") +
  theme(legend.position = "none")#+
  # ggtitle("Home range (KDE 95%) by step_revisit (data subset)")

# p1; p2

```

### Visual with data subset
```{r visual}
# Subset
db_ss <- db %>%  
  filter(p_foraging == val_p_foraging[1] &
           step_forget == val_step_forget[1] &
           duration == val_duration[1] #&
           # visual == val_visual[1]
         )

p3 <- db_ss %>%
  ggplot(aes(x=visual, y=DPL, fill = feedingbout)) +
  ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  theme(legend.position = "bottom")

# Home range
p4 <- db_ss %>% 
  ggplot(aes(x=visual, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  theme(legend.position = "bottom") #+
  # ggtitle("Home range (KDE 95%) by visual (data subset)")

```

### p_foraging with data subset
```{r p_foraging}
# Subset
db_ss <- db %>%  
  filter(#p_foraging == val_p_foraging[1] &
           step_forget == val_step_forget[1] &
           duration == val_duration[1] &
           visual == val_visual[1]
         )

p5 <- db_ss %>%
  ggplot(aes(x=p_foraging, y=DPL, fill = feedingbout)) +
  ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  theme(legend.position = "none")


# Home range
p6 <- db_ss %>% 
  ggplot(aes(x=p_foraging, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  theme(legend.position = "none")#+
  # ggtitle("Home range (KDE 95%) by p_foraging (data subset)")

```

### Duration with data subset
```{r duration}
# Subset
db_ss <- db %>%  
  filter(p_foraging == val_p_foraging[1] &
           step_forget == val_step_forget[1] &
           # duration == val_duration[1] &
           visual == val_visual[1]
         )

p7 <- db_ss %>%
  ggplot(aes(x=duration, y=DPL, fill = feedingbout)) +
  ylab("DPL (m)") +
  geom_boxplot(width = 0.4) +
  theme(legend.position = "bottom")

# Home range
p8 <- db_ss %>% 
  ggplot(aes(x=duration, y=KDE95, color = feedingbout)) +
  # facet_wrap(~feedingbout) +
  geom_boxplot() +
  theme(legend.position = "bottom") #+
  # ggtitle("Home range (KDE 95%) by duration (data subset)")
```

### Energy with data subset
```{r}
# Let's check the effect with less noise of parameter variation:
db_ss <- db %>%  
  filter(p_foraging == val_p_foraging[1] &
           step_forget == val_step_forget[1] &
           duration == val_duration[1] &
           visual == val_visual[1]
         )

db_ss %>%
  ggplot(aes(x=energy, fill = feedingbout)) +
  geom_density(alpha=0.4) +
  theme_set(theme_bw(base_size = 10))

# db_ss %>% group_by(siminputrow) %>% 
#   filter(energy < 1) %>%
#   flextable()

```

It seems that when feeding bout is on, agents slightly tend to keep higher levels of energy, but I would not say this effect is big. Without the feeding bout parametrization, agents usually hit higher levels of energy. This might be the reason why DPL is higher in these situations.



##### Plotting
```{r}
# Remove axis titles from all plots
# p = list(p1, p2, p3, p4) %>% map(~.x + labs(x=NULL, y=NULL)) %>% map(~.x + ggtitle(NULL))
# q = list(p5, p6, p7, p8) %>% map(~.x + labs(x=NULL, y=NULL)) %>% map(~.x + ggtitle(NULL))

# Same yaxis every grob https://community.rstudio.com/t/common-axis-title-in-grid-arrange/96353/2
gridExtra::grid.arrange(arrangeGrob(p1, p2, p3, p4,
                                    ncol = 2, nrow = 2) #,
                        # arrangeGrob(p9)
                        )
```
\pagebreak
```{r}
gridExtra::grid.arrange(arrangeGrob(p5, p6, p7, p8,
                                    ncol = 2, nrow = 2))

```


